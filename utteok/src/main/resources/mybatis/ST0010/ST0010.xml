<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="halfandhalf.domain.ST0010.dao.ST0010Dao">
	<select id="findStore" resultType="halfandhalf.domain.ST0010.dto.ST0010Dto">
		SELECT
			  SI.STORE_SEQ
			, SI.COUNT_STORE
			, SI.STORE_NAME
			, SI.STORE_ADDRESS
			, SI.MENU_NAME
			, SI.REVIEW
			, SI.file_path
			, file_original_name
			, SI.file_masking_name
			, (SELECT NAME_KO FROM public_code pc WHERE 1=1 AND pc.code_category_id = 102 AND pc.CODE = qs.question1) AS question1
			, (SELECT NAME_KO FROM public_code pc WHERE 1=1 AND pc.code_category_id = 102 AND pc.CODE = qs.question2) AS question2
			, (SELECT NAME_KO FROM public_code pc WHERE 1=1 AND pc.code_category_id = 102 AND pc.CODE = qs.question3) AS question3
			, (SELECT NAME_KO FROM public_code pc WHERE 1=1 AND pc.code_category_id = 102 AND pc.CODE = qs.question4) AS question4
			, (SELECT NAME_KO FROM public_code pc WHERE 1=1 AND pc.code_category_id = 102 AND pc.CODE = qs.question5) AS question5
			, (SELECT NAME_KO FROM public_code pc WHERE 1=1 AND pc.code_category_id = 102 AND pc.CODE = qs.question6) AS question6
			, (SELECT NAME_KO FROM public_code pc WHERE 1=1 AND pc.code_category_id = 102 AND pc.CODE = qs.question7) AS question7
		FROM
			STORE_INFO SI
			JOIN QUESTION_FOR_SELECT QS ON SI.question_seq = qs.question_seq
		WHERE
			1=1
			<if test='question1 != null  and question2 != null  and question3 != null  and question4 != null  and question5 != null  and question6 != null  and question7 != null'>
				AND qs.question1 = #{question1}
				AND qs.question2 = #{question2}
				AND qs.question3 = #{question3}
				AND qs.question4 = #{question4}
				AND qs.question5 = #{question5}
				AND qs.question6 = #{question6}
				AND qs.question7 = #{question7}
			</if>
		ORDER BY rand()
		LIMIT 1
	</select>

	<select id="findByCount" resultType="halfandhalf.domain.ST0010.dto.ST0010Dto">
		SELECT
			  STORE_SEQ
			, COUNT_STORE
			, STORE_NAME
			, file_path
			, file_original_name
			, file_masking_name
		FROM
			STORE_INFO
		WHERE
			1=1
		ORDER BY
			COUNT_STORE DESC
		LIMIT 4
	</select>

	<update id="updateStoreCount" parameterType="halfandhalf.domain.ST0010.dto.ST0010Dto">
		UPDATE
			STORE_INFO
		SET
			COUNT_STORE = #{count_store}
		WHERE
			1=1
			AND store_seq = #{store_seq}
	</update>
</mapper>
